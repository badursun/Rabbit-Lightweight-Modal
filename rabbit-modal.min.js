!function(t){"use strict";class e{static#t=new Set;static#e={title:"",content:"",size:"default",position:"center",buttons:[],overlay:!0,overlayColor:"rgba(15, 23, 42, 0.6)",overlayBlur:!1,closeOnEscape:!0,closeOnBackdrop:!0,showHeaderClose:!0,stackable:!1,type:null,timer:{enabled:!1,duration:3e3,progress:!1,closeOnTimeup:!0,onTimeup:null,onTick:null,tickInterval:1e3},ajax:{url:null,method:"GET",headers:{},data:null,contentType:"json",loadingText:"Loading...",delay:0,timeout:3e4,retry:{enabled:!1,limit:3,delay:1e3},credentials:"same-origin",onStart:null,onSuccess:null,onError:null,onComplete:null},debug:!1};#s=null;#i={};#o=new Map;#n=null;#r=null;#a=null;#l=null;#h=0;#d={};#c=!1;#m=null;#u=0;#p=null;#b=!1;#g=!1;constructor(t={}){this.#i={...e.#e,...t},e.#t.add(this),this.#y("info","Modal instance created",{options:this.#i}),this.#v(),this.#i.ajax?.url&&this.#w()}#v(){const t=document.createElement("div");t.className="rabbit-modal",this.#i.class&&t.classList.add(this.#i.class),this.#i.type&&t.classList.add(`rabbit-modal-${this.#i.type}`);const e=document.createElement("div");e.className="rabbit-overlay",this.#i.overlay?(this.#i.overlayColor&&(e.style.backgroundColor=this.#i.overlayColor),this.#i.overlayBlur&&e.classList.add("rabbit-overlay-blur")):e.style.display="none",t.appendChild(e);const s=document.createElement("div");s.className="rabbit-modal-dialog";const i=document.createElement("div");i.className="rabbit-modal-progress",i.style.width="0",i.style.display="none";const o=document.createElement("div");if(o.className="rabbit-modal-progress-animation",i.appendChild(o),s.appendChild(i),this.#a=i,t.appendChild(s),!this.#i.type&&(this.#i.title||this.#i.showHeaderClose)){const t=document.createElement("div");if(t.className="rabbit-modal-header",this.#i.title){const e=document.createElement("h3");e.className="rabbit-modal-title",e.textContent=this.#i.title,t.appendChild(e)}if(this.#i.showHeaderClose){const e=document.createElement("button");e.className="rabbit-modal-close",e.setAttribute("data-action","close"),e.innerHTML='\n<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n</svg>\n',t.appendChild(e)}s.appendChild(t)}const n=document.createElement("div");if(n.className="rabbit-modal-body",this.#i.type){const t=document.createElement("div");t.className="rabbit-alert-icon";const e={success:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />\n</svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>'};if(t.innerHTML=e[this.#i.type]||"",n.appendChild(t),this.#i.title){const t=document.createElement("h3");t.className="rabbit-alert-title",t.textContent=this.#i.title,n.appendChild(t)}}if("string"==typeof this.#i.content){const t=document.createElement("div");t.className="rabbit-modal-content",t.innerHTML=this.#i.content,n.appendChild(t)}else if(this.#i.content instanceof HTMLElement){const t=document.createElement("div");t.className="rabbit-modal-content",t.appendChild(this.#i.content),n.appendChild(t)}if(s.appendChild(n),this.#i.buttons&&this.#i.buttons.length>0){const t=document.createElement("div");t.className="rabbit-modal-footer",s.appendChild(t),this.#i.buttons.forEach((e=>{const s=document.createElement("button");s.className=`rabbit-btn ${e.type?`rabbit-btn-${e.type}`:""} ${e.class||""}`,s.textContent=e.text,e.key&&s.setAttribute("data-rabbit-action",e.key),t.appendChild(s)})),t.addEventListener("click",(t=>{const e=t.target.closest("button");if(!e)return;const s=e.getAttribute("data-rabbit-action");if(!s)return void this.hide();const i=this.#i.buttons.find((t=>t.key===s));i&&"function"==typeof i.callback?i.callback(this):"close"===s&&this.hide()}))}return document.body.appendChild(t),this.#s=t,this.#f(),this.#x(),this.#k(),t}#f(){const t=this.#s.querySelector(".rabbit-overlay");if(this.#i.closeOnBackdrop&&t){const e=e=>{e.target===t&&this.hide()};t.addEventListener("click",e),this.#d.overlay=e}if(this.#s.querySelectorAll('[data-action="close"]').forEach((t=>{const e=()=>this.hide();t.addEventListener("click",e),this.#d.closeButtons||(this.#d.closeButtons=[]),this.#d.closeButtons.push({element:t,handler:e})})),this.#i.closeOnEscape){const t=t=>{"Escape"===t.key&&this.#c&&this.hide()};document.addEventListener("keydown",t),this.#d.escKey=t}}#x(){const t=this.#s.querySelector(".rabbit-modal-dialog");if(!t)return;if(t.classList.remove("center","left","left-sidebar","right","right-sidebar","top","top-left","top-right","bottom","bottom-left","bottom-right","fullwidth-top","fullwidth-bottom"),"cover-page"===this.#i.size)return;const e={center:"center",left:"left","left-sidebar":"left-sidebar",right:"right","right-sidebar":"right-sidebar",top:"top","top-left":"top-left","top-right":"top-right",bottom:"bottom","bottom-left":"bottom-left","bottom-right":"bottom-right","fullwidth-top":"fullwidth-top","fullwidth-bottom":"fullwidth-bottom"}[this.#i.position];e&&t.classList.add(e)}#k(){const t=this.#s.querySelector(".rabbit-modal-dialog");if(!t)return;t.classList.remove("small","default","large","xlarge","cover-page");const e=["small","default","large","xlarge","cover-page"].includes(this.#i.size)?this.#i.size:"default";t.classList.add(e),"cover-page"===e?(t.style.maxWidth="100%",t.style.maxHeight="100vh"):(t.style.maxWidth="",t.style.maxHeight="")}#j(t,e=null){const s=new CustomEvent(`rabbit-modal-${t}`,{detail:{modal:this,data:e}});this.#s.dispatchEvent(s),this.#y("event",`Event emitted: ${t}`,e),document.dispatchEvent(s)}#C(t){return{success:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />\n</svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n</svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />\n</svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n</svg>'}[t]||""}#L(){if(this.#a){if(this.#b)return this.#a.style.display="block",this.#a.classList.add("loading"),void(this.#a.style.width="100%");if(this.#g&&this.#l){this.#a.style.display="block";const t=Date.now()-this.#l,e=Math.max(0,this.#h-t)/this.#h*100;this.#a.classList.remove("loading"),this.#a.style.width=`${e}%`,e>0?requestAnimationFrame((()=>this.#L())):this.#a.style.display="none"}else this.#a.style.display="none",this.#a.style.width="0"}}show(){return this.#s.offsetHeight,this.#s.classList.add("show"),this.#c=!0,this.#i.overlayBlur&&document.body.classList.add("rabbit-modal-blur"),this.#i.timer?.enabled&&this.#i.timer?.duration>0&&this.startTimer(),this.#j("show"),this}startTimer(){if(this.#i.timer?.enabled&&!this.#n){if(this.#l=Date.now(),this.#h=this.#i.timer.duration,this.#i.timer.progress&&(this.#g=!0,this.#L()),this.#j("timer-start"),this.#i.timer.onTick){const t=this.#i.timer.tickInterval||1e3;this.#r=setInterval((()=>{const t=Date.now()-this.#l,e=Math.max(0,this.#h-t),s=Math.ceil(e/1e3);this.#i.timer.onTick(s,this),e<=0&&clearInterval(this.#r)}),t)}this.#n=setTimeout((async()=>{this.#r&&(clearInterval(this.#r),this.#r=null),this.#j("timer-end"),this.#i.timer.onTimeup&&await this.#i.timer.onTimeup(this),this.#i.timer.closeOnTimeup&&this.hide()}),this.#i.timer.duration)}}hide(){return this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r&&(clearInterval(this.#r),this.#r=null),this.#c=!1,this.#s.classList.remove("show"),this.#i.overlayBlur&&document.body.classList.remove("rabbit-modal-blur"),this.#b=!1,this.#g=!1,setTimeout((()=>{this.#s&&this.#s.parentNode&&this.#s.parentNode.removeChild(this.#s),this.#j("hide")}),200),this}destroy(){if(e.#t.delete(this),this.#d){if(this.#d.overlay){const t=this.#s?.querySelector(".rabbit-overlay");t&&t.removeEventListener("click",this.#d.overlay)}this.#d.closeButtons&&this.#d.closeButtons.forEach((({element:t,handler:e})=>{t.removeEventListener("click",e)})),this.#d.escKey&&document.removeEventListener("keydown",this.#d.escKey)}this.#i.overlayBlur&&document.body.classList.remove("rabbit-modal-blur"),this.#s&&this.#s.parentNode&&this.#s.parentNode.removeChild(this.#s),this.#s=null,this.#i={},this.#o.clear(),this.#d={},this.#c=!1,this.abortAjax()}addEventListener(t,e){this.#s.addEventListener(`rabbit-modal-${t}`,e)}removeEventListener(t,e){this.#s.removeEventListener(`rabbit-modal-${t}`,e)}static#E(){return Array.from(e.#t).filter((t=>t.#c))}#y(t,e,s=null){if(!this.#i.debug)return;const i=`[RabbitModal Debug ${(new Date).toISOString()}]`;switch(t){case"info":console.info(`${i} ℹ️`,e,s||"");break;case"error":console.error(`${i} ❌`,e,s||"");break;case"warn":console.warn(`${i} ⚠️`,e,s||"");break;case"success":console.log(`${i} ✅`,e,s||"");break;case"event":console.log(`${i} 🔔`,e,s||"");break;case"ajax":console.log(`${i} 🔄`,e,s||"");break;default:console.log(`${i}`,e,s||"")}}abortAjax(){this.#m&&(this.#m.abort(),this.#m=null,this.#j("ajax-abort")),this.#p&&(clearTimeout(this.#p),this.#p=null)}reloadAjax(){return this.#i.ajax?.url&&this.#w(),this}async#w(){if(this.#i.ajax?.url){this.abortAjax();try{this.#b=!0,this.#L(),this.#i.ajax.onStart&&this.#i.ajax.onStart(this,this.#s.querySelector(".rabbit-modal-content")),this.#j("ajax-start"),this.#i.ajax.delay&&(this.#y("info","AJAX request delayed",{delay:this.#i.ajax.delay}),await new Promise((t=>setTimeout(t,this.#i.ajax.delay)))),this.#m=new AbortController;const t=fetch(this.#i.ajax.url,{method:this.#i.ajax.method||"GET",headers:this.#i.ajax.headers||{},body:this.#i.ajax.data?JSON.stringify(this.#i.ajax.data):null,signal:this.#m.signal,credentials:this.#i.ajax.credentials||"same-origin"});let e;const s=new Promise(((t,s)=>{this.#i.ajax.timeout&&(e=setTimeout((()=>{this.abortAjax(),s(new Error("Request timeout"))}),this.#i.ajax.timeout))})),i=await Promise.race([t,s]).finally((()=>{e&&clearTimeout(e)}));if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const o=await this.#T(i);this.#y("success","AJAX request successful",{data:o}),this.#i.ajax.onSuccess&&this.#i.ajax.onSuccess(this,o,this.#s.querySelector(".rabbit-modal-content")),this.#j("ajax-success",o)}catch(t){if("AbortError"===t.name)return this.#y("warn","AJAX request aborted"),void this.#j("ajax-abort");if(this.#i.ajax.retry?.enabled&&(!this.#u||this.#u<this.#i.ajax.retry.limit))return this.#u=(this.#u||0)+1,this.#y("warn","AJAX request failed, initiating retry",{error:t.message,currentAttempt:this.#u,maxAttempts:this.#i.ajax.retry.limit,retryDelay:this.#i.ajax.retry.delay,nextAttemptIn:`${this.#i.ajax.retry.delay}ms`}),await new Promise((t=>setTimeout(t,this.#i.ajax.retry.delay))),this.#y("info","Starting retry attempt",{attempt:this.#u,url:this.#i.ajax.url}),void this.#w();this.#u>=this.#i.ajax.retry.limit&&this.#y("error","AJAX retry limit exceeded",{error:t.message,attempts:this.#u,limit:this.#i.ajax.retry.limit}),this.#y("error","AJAX request failed",{error:t}),this.#i.ajax.onError&&this.#i.ajax.onError(this,t,this.#s.querySelector(".rabbit-modal-content")),this.#j("ajax-error",t)}finally{this.#b=!1,this.#a&&(this.#g?this.#L():(this.#a.style.display="none",this.#a.style.width="0",this.#a.classList.remove("loading"))),this.#i.ajax.onComplete&&this.#i.ajax.onComplete(this,this.#s.querySelector(".rabbit-modal-content")),this.#y("info","AJAX request completed"),this.#j("ajax-complete")}}}async#T(t){const e=this.#i.ajax.contentType.toLowerCase();switch(e){case"json":return await t.json();case"html":case"text":return await t.text();default:throw new Error(`Unsupported content type: ${e}`)}}#B(t){const e="html"===this.#i.ajax.contentType||"string"==typeof t?t:JSON.stringify(t,null,2),s=this.#s.querySelector(".rabbit-modal-content");s&&(s.innerHTML=e)}getElement(){return this.#s}getContent(){return this.#s?.querySelector(".rabbit-modal-content")}getHeader(){return this.#s?.querySelector(".rabbit-modal-header")}getBody(){return this.#s?.querySelector(".rabbit-modal-body")}getFooter(){return this.#s?.querySelector(".rabbit-modal-footer")}}"undefined"!=typeof module&&module.exports?module.exports=e:t.RabbitModal=e}("undefined"!=typeof window?window:this);